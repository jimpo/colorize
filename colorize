#!/usr/bin/env ruby

require 'optparse'

$BLACK, $RED, $GREEN, $YELLOW, $BLUE, $MAGENTA, $CYAN, $WHITE = *(30..37)


def color_code c
  "%c[%d;%d;%dm" % [0x1B, 0, c, 40]
end

def random_color
  color_code($RED + rand($WHITE - $RED))
end

def parse_options
  options = {}
  OptionParser.new do |opts|
    opts.banner = "Usage: colorize [options]"

    opts.on("--style STYLE", [:random],
            "Specify coloring style (random)") do |style|
      case style
      when :random then
        options[:next] = lambda { random_color }
      end
    end
  end.parse!
  options
end

def main
  options = parse_options
  STDIN.each_line do |line|
    line.each_char do |c|
      print options[:next].call unless /\s/ =~ c
      print c
    end
    print color_code($WHITE)
  end
end

if __FILE__ == $PROGRAM_NAME
  main
end
